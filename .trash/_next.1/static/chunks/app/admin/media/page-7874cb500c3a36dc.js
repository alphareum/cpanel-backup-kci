(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[565],{3510:function(e,t,a){Promise.resolve().then(a.bind(a,5099))},5099:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var l=a(7573),n=a(7653),i=a(8428);function s(e){let{label:t="Metadata",value:a,onChange:i}=e,s=(0,n.useMemo)(()=>{let e=a&&"object"==typeof a?Object.entries(a).map(e=>{let[t,a]=e;return{key:t,value:a}}):[];return 0===e.length?[{key:"",value:""}]:e},[a]);function r(e,t,a){o(s.map((l,n)=>n===e?{...l,[t]:a}:l))}function o(e){i(e.filter(e=>""!==e.key.trim()).reduce((e,t)=>(e[t.key]=t.value,e),{}))}return(0,l.jsxs)("div",{className:"stack",children:[(0,l.jsx)("span",{style:{fontWeight:600},children:t}),(0,l.jsx)("div",{className:"metadata-grid",children:s.map((e,t)=>(0,l.jsxs)("div",{className:"metadata-row",children:[(0,l.jsx)("input",{type:"text",placeholder:"Key",value:e.key,onChange:e=>r(t,"key",e.target.value)}),(0,l.jsx)("input",{type:"text",placeholder:"Value",value:e.value,onChange:e=>r(t,"value",e.target.value)}),(0,l.jsx)("button",{type:"button",className:"button secondary",onClick:()=>(function(e){let t=s.filter((t,a)=>a!==e);o(t.length?t:[{key:"",value:""}])})(t),children:"Remove"})]},t))}),(0,l.jsx)("div",{children:(0,l.jsx)("button",{type:"button",className:"button",onClick:function(){o([...s,{key:"",value:""}])},children:"Add metadata"})})]})}var r=a(7656);let o=[{type:"gallery",label:"Gallery"},{type:"testimonial",label:"Testimonials"},{type:"partner",label:"Partners"}];function d(e){return{id:null,type:e,title:"",description:"",asset_url:"",metadata:{}}}function c(){let[e,t]=(0,n.useState)(o[0].type),a="/media/".concat(e),{data:c,error:u,isLoading:m,mutate:p}=(0,i.ZP)(a,()=>(0,r.R1)(a)),h=(0,n.useMemo)(()=>{var e;return null!==(e=null==c?void 0:c.items)&&void 0!==e?e:[]},[c]),[y,f]=(0,n.useState)(!1),[v,g]=(0,n.useState)(()=>d(e)),[x,b]=(0,n.useState)(""),[j,k]=(0,n.useState)(!1),[N,C]=(0,n.useState)(!1),[_,w]=(0,n.useState)(!1),S=(0,n.useRef)(null),[D,R]=(0,n.useState)(null),[P,T]=(0,n.useState)(null);function E(){C(!1),w(!1),S.current&&(S.current.value="")}function F(){f(!1),k(!1),b(""),E()}function L(e,t){g(a=>({...a,[e]:t}))}let U=(0,n.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g(a=>{let l={...a.metadata||{}};return l.uploaded_file_url=e,t.originalName&&(l.original_filename=t.originalName),t.mimeType&&(l.upload_mime_type=t.mimeType),void 0!==t.size&&(l.upload_file_size=String(t.size)),t.storage&&(l.upload_storage=t.storage),t.storageKey&&(l.upload_storage_key=t.storageKey),t.folder&&(l.upload_folder=t.folder),{...a,asset_url:e,metadata:l}})},[]),z=(0,n.useCallback)(async e=>{if(e&&!N){C(!0),b("");try{let t=new FormData;t.append("file",e),t.append("type",v.type);let a=await (0,r.zi)("/media/upload",t);U(a.url,a.metadata||{}),b("")}catch(e){b(e.message||"Failed to upload file")}finally{C(!1),w(!1),S.current&&(S.current.value="")}}},[U,v.type,N]),O=(0,n.useCallback)(e=>{let[t]=e.target.files||[];t&&!N&&z(t)},[z,N]),A=(0,n.useCallback)(e=>{var t,a;if(e.preventDefault(),e.stopPropagation(),w(!1),N)return;let l=null===(a=e.dataTransfer)||void 0===a?void 0:null===(t=a.files)||void 0===t?void 0:t[0];l&&z(l)},[z,N]),W=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),N||w(!0)},[N]),M=(0,n.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),w(!1)},[]),K=(0,n.useCallback)(()=>{var e;N||null===(e=S.current)||void 0===e||e.click()},[N]);async function B(e){var t,a,l;if(e.preventDefault(),N){b("Please wait for the upload to finish before saving.");return}let n=null!==(a=null===(t=v.asset_url)||void 0===t?void 0:t.trim())&&void 0!==a?a:"";if(!n){b("Please provide an asset URL or upload a file before saving.");return}if(!function(e){if(!e)return!1;let t=e.trim();if(!t)return!1;if(t.startsWith("/"))return!0;try{let e=new URL(t);return!!e.protocol&&!!e.hostname}catch(e){return!1}}(n)){b("Please provide a valid URL or uploaded file path (starting with /).");return}k(!0),b("");let i={id:null!==(l=v.id)&&void 0!==l?l:void 0,type:v.type,title:v.title||null,description:v.description||null,asset_url:n,metadata:Object.keys(v.metadata||{}).length?v.metadata:null};try{await (0,r.sg)("/media",i),await p(),F()}catch(e){b(e.message||"Failed to save media item")}finally{k(!1)}}async function I(){if(P){R(P.id);try{await (0,r.QW)("/media/".concat(P.id)),await p(),T(null)}catch(e){alert(e.message||"Failed to delete media item")}finally{R(null)}}}return(0,l.jsxs)("section",{children:[(0,l.jsxs)("header",{className:"action-bar",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{style:{margin:0},children:"Media Library"}),(0,l.jsx)("p",{style:{margin:0,color:"#555"},children:"Upload links for gallery images, testimonials, and partner logos."})]}),(0,l.jsx)("button",{className:"button",onClick:function(){g(d(e)),b(""),f(!0),E()},children:"New asset"})]}),(0,l.jsx)("div",{className:"tabs",role:"tablist",children:o.map(a=>(0,l.jsx)("button",{type:"button",role:"tab","aria-selected":e===a.type,className:"tab ".concat(e===a.type?"active":""),onClick:()=>{var e;t(e=a.type),f(!1),g(d(e)),b(""),E()},children:a.label},a.type))}),u?(0,l.jsx)("div",{className:"alert",children:u.message}):null,m?(0,l.jsx)("p",{children:"Loading media…"}):0===h.length?(0,l.jsx)("div",{className:"empty-state",children:"No media yet. Add your first item."}):(0,l.jsx)("div",{className:"list",children:h.map(e=>(0,l.jsx)("div",{className:"card",children:(0,l.jsxs)("div",{className:"stack",children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[(0,l.jsxs)("div",{className:"stack",style:{gap:"0.35rem"},children:[(0,l.jsx)("h2",{style:{margin:0},children:e.title||"Untitled"}),(0,l.jsx)("p",{style:{margin:0,color:"#555"},children:e.description||"—"}),(0,l.jsx)("a",{href:e.asset_url,target:"_blank",rel:"noreferrer",children:e.asset_url})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:"0.5rem"},children:[(0,l.jsx)("button",{className:"button secondary",onClick:()=>{var t,a,l,n;g({id:e.id,type:e.type,title:null!==(t=e.title)&&void 0!==t?t:"",description:null!==(a=e.description)&&void 0!==a?a:"",asset_url:null!==(l=e.asset_url)&&void 0!==l?l:"",metadata:null!==(n=e.metadata)&&void 0!==n?n:{}}),b(""),f(!0),E()},children:"Edit"}),(0,l.jsx)("button",{className:"button secondary",onClick:()=>{T(e)},disabled:D===e.id,children:D===e.id?"Deleting…":"Delete"})]})]}),e.metadata?(0,l.jsxs)("div",{style:{fontSize:"0.85rem",color:"#555"},children:[(0,l.jsx)("strong",{children:"Metadata:"})," ",Object.entries(e.metadata).map(e=>{let[t,a]=e;return(0,l.jsxs)("span",{style:{marginRight:"0.75rem"},children:[t,": ",String(a)]},t)})]}):null]})},e.id))}),P?(0,l.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,l.jsxs)("div",{className:"modal",style:{maxWidth:"480px"},children:[(0,l.jsxs)("header",{className:"stack",style:{marginBottom:"1rem"},children:[(0,l.jsx)("h2",{style:{margin:0},children:"Remove asset?"}),(0,l.jsxs)("p",{style:{margin:0,color:"#555"},children:["Are you sure you want to remove “",P.title||P.asset_url,"” from the media library? This action cannot be undone."]})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:"0.75rem"},children:[(0,l.jsx)("button",{type:"button",className:"button secondary",onClick:function(){D||T(null)},disabled:!!D,children:"Cancel"}),(0,l.jsx)("button",{type:"button",className:"button",onClick:I,disabled:!!D,children:P&&D===P.id?"Deleting…":"Remove"})]})]})}):null,y?(0,l.jsx)("div",{className:"modal-backdrop",role:"dialog","aria-modal":"true",children:(0,l.jsxs)("div",{className:"modal",children:[(0,l.jsxs)("header",{className:"stack",style:{marginBottom:"1rem"},children:[(0,l.jsx)("h2",{style:{margin:0},children:v.id?"Edit asset":"Add asset"}),(0,l.jsx)("p",{style:{margin:0,color:"#555"},children:"Provide the public URL for the media and optional metadata (alt text, credits, etc.)."})]}),x?(0,l.jsx)("div",{className:"alert",children:x}):null,(0,l.jsxs)("form",{className:"stack",onSubmit:B,children:[(0,l.jsxs)("div",{className:"form-grid two-col",children:[(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"media-title",children:"Title"}),(0,l.jsx)("input",{id:"media-title",type:"text",value:v.title,onChange:e=>L("title",e.target.value)})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"media-type",children:"Type"}),(0,l.jsx)("select",{id:"media-type",value:v.type,onChange:e=>L("type",e.target.value),children:o.map(e=>(0,l.jsx)("option",{value:e.type,children:e.label},e.type))})]})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"media-description",children:"Description"}),(0,l.jsx)("textarea",{id:"media-description",rows:2,value:v.description,onChange:e=>L("description",e.target.value)})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{children:"Upload asset"}),(0,l.jsxs)("div",{role:"button",tabIndex:0,onClick:K,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),K())},onDragEnter:W,onDragOver:W,onDragLeave:M,onDrop:A,style:{border:"2px dashed",borderColor:_?"#1f6feb":"#d0d7de",borderRadius:"0.75rem",padding:"1.5rem",textAlign:"center",background:_?"#f0f6ff":"#f9fafb",cursor:N?"progress":"pointer",opacity:N?.75:1,transition:"all 0.2s ease-in-out",outline:"none"},children:[(0,l.jsx)("input",{ref:S,type:"file",accept:"image/*",style:{display:"none"},onChange:O}),(0,l.jsxs)("div",{className:"stack",style:{gap:"0.35rem",alignItems:"center"},children:[(0,l.jsx)("strong",{children:N?"Uploading…":"Drag and drop or click to select a file"}),(0,l.jsx)("span",{style:{fontSize:"0.85rem",color:"#555"},children:"We'll host this asset and provide a reusable public link."}),v.asset_url?(0,l.jsxs)("span",{style:{fontSize:"0.85rem",color:"#1f6feb",wordBreak:"break-word"},children:["Current URL: ",v.asset_url]}):null]})]}),(0,l.jsx)("span",{style:{fontSize:"0.8rem",color:"#555"},children:"Prefer an external resource? Paste its link below."})]}),(0,l.jsxs)("div",{className:"input-group",children:[(0,l.jsx)("label",{htmlFor:"media-url",children:"Asset URL"}),(0,l.jsx)("input",{id:"media-url",type:"text",value:v.asset_url,onChange:e=>L("asset_url",e.target.value)})]}),(0,l.jsx)(s,{value:v.metadata,onChange:e=>L("metadata",e)}),(0,l.jsxs)("div",{className:"actions",children:[(0,l.jsx)("button",{type:"button",className:"button secondary",onClick:F,disabled:j||N,children:"Cancel"}),(0,l.jsx)("button",{type:"submit",className:"button",disabled:j||N,children:j?"Saving…":"Save asset"})]})]})]})}):null]})}},7656:function(e,t,a){"use strict";async function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat("http://127.0.0.1:3001/api").concat(e),l="undefined"!=typeof FormData&&t.body instanceof FormData?{...t.headers||{}}:{"Content-Type":"application/json",...t.headers||{}},n=await fetch(a,{...t,headers:l});if(!n.ok){let e=n.statusText;try{let t=await n.json();e=(null==t?void 0:t.message)||e}catch(e){}throw Error(e||"Request failed")}return 204===n.status?null:await n.json()}function n(e){return l(e,{method:"GET"})}function i(e,t){return l(e,{method:"POST",body:JSON.stringify(t)})}function s(e,t){return l(e,{method:"POST",body:t})}function r(e){return l(e,{method:"DELETE"})}a.d(t,{QW:function(){return r},R1:function(){return n},sg:function(){return i},zi:function(){return s}})}},function(e){e.O(0,[428,293,286,744],function(){return e(e.s=3510)}),_N_E=e.O()}]);